<!DOCTYPE html>
<html>
  <head>

    <title>HappyMinute</title>

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <%= stylesheet_link_tag    'application', media: 'all' %>
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
    <script>
      function subscribeNotification () {
        var appId        = ONESIGNAL_APP_ID;
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
          OneSignal.init({
            appId: appId,
            autoRegister: false,
            allowLocalhostAsSecureOrigin: true,
            notifyButton: {
              enable: true
            },
            webhooks: {
              cors: true
            }
          });
          OneSignal.on('subscriptionChange', function (isSubscribed) {
            if (isSubscribed) {
              OneSignal.getUserId(function(userId) {
                var user_params = { onesignal_id: userId };
                return userService.updateUser(user_params)
                  .then(onSuccess);
                function onSuccess (response) {
                  var user = response.data.user;
                  OneSignal.push(["sendTag", "user_id", user.id]);
                  OneSignal.push(["sendTag", "user_name", user.name]);
                  OneSignal.push(["sendTag", "user_email", user.email]);
                }
              });
            }
          });
        });
      }
    </script>

  </head>

  <body>

    <div id="navbar"> <%= render partial: "shared/navbar" %> </div>

    <div id="alerts"> <%= render partial: "shared/alerts" %> </div>

    <%= content_for?(:application) ? (yield :application) : (yield) %>

    <div id="footer"> <%= render partial: "shared/footer" %> </div>

    <a href="#" class="back-to-top">
      <i class="lnr lnr-arrow-up"></i>
    </a>

    <div id="loader">
      <div class="spinner">
        <div class="double-bounce1"></div>
        <div class="double-bounce2"></div>
      </div>
    </div>

    <%= javascript_include_tag 'application' %>

  </body>

</html>
